<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SCFHS Hybrid Rationale Engine (Demo)</title>

<style>
body {
  font-family: Arial, sans-serif;
  background:#f4f6f8;
  padding:20px;
}
.container {
  max-width:900px;
  margin:auto;
  background:#fff;
  padding:25px;
  border-radius:8px;
  box-shadow:0 0 10px rgba(0,0,0,0.1);
}
.option {
  margin:10px 0;
  padding:10px;
  border:1px solid #ccc;
  border-radius:6px;
}
button {
  margin-top:15px;
  padding:10px 20px;
  font-size:16px;
}
.hidden { display:none; }

.rationale {
  margin-top:20px;
  padding:15px;
  background:#f9fafb;
  border-left:5px solid #007bff;
}

.trap {
  margin-top:8px;
  padding:8px;
  border-radius:6px;
  font-size:14px;
}
.trap.nclex { background:#eef5ff; border-left:4px solid #0d6efd; }
.trap.str { background:#fff7e6; border-left:4px solid #f0ad4e; }
.trap.danger { background:#fbeaea; border-left:4px solid #d9534f; }

.patho {
  margin-top:15px;
  background:#eef5ff;
  padding:10px;
  border-left:4px solid #007bff;
}
</style>
</head>

<body>
<div class="container">

<h2>SCFHS Level-4 Hard ‚Äî Hybrid Engine Demo</h2>

<p><b>Question:</b><br>
A 68-year-old postoperative patient becomes restless.  
BP 84/50, HR 128, RR 30, SpO‚ÇÇ 91%.  
Urine output is 20 mL/hr.<br><br>
What is the <b>PRIORITY</b> nursing action?
</p>

<div class="option">
  <input type="radio" name="q1" value="A"> A. Start isotonic IV fluids
</div>
<div class="option">
  <input type="radio" name="q1" value="B"> B. Administer IV antibiotics
</div>
<div class="option">
  <input type="radio" name="q1" value="C"> C. Give furosemide
</div>
<div class="option">
  <input type="radio" name="q1" value="D"> D. Obtain blood cultures
</div>

<button onclick="submitAnswer()">Submit</button>

<div id="output" class="rationale hidden"></div>

</div>

<script>
/* ===============================
   LAYER 1: RULE ENGINE (LOCKED)
   =============================== */

const ruleEngine = {
  shockType: "Hypovolemic Shock",
  correctAnswer: "A",
  priorityAction: "Start isotonic IV fluids",
  traps: {
    B: { type: "nclex", text: "Correct treatment, wrong timing. Antibiotics do not correct hypotension." },
    C: { type: "danger", text: "Diuretics worsen intravascular volume depletion." },
    D: { type: "str", text: "Diagnostic action delays life-saving intervention." }
  }
};

/* ===============================
   LAYER 2: SIMULATED LLM OUTPUT
   (replace later with API call)
   =============================== */

let llmRationale = `
Acute postoperative intravascular volume loss reduces venous return to the heart,
leading to decreased preload and stroke volume. This results in reduced cardiac output
and mean arterial pressure, causing hypotension and oliguria. Rapid isotonic fluid
administration restores circulating volume and tissue perfusion.
`;

/* ===============================
   FALLBACK TEMPLATE (SAFE)
   =============================== */

const fallbackRationale = `
Loss of circulating volume decreases preload and cardiac output, resulting in
hypotension and inadequate organ perfusion. Isotonic IV fluids are required to
restore intravascular volume and maintain tissue perfusion.
`;

/* ===============================
   VALIDATION FUNCTION
   =============================== */

function validateLLM(text) {
  if (!text) return false;
  if (text.length < 200) return false;        // too generic
  if (text.includes("always") || text.includes("in general")) return false;
  return true;
}

/* ===============================
   SUBMIT HANDLER
   =============================== */

function submitAnswer() {
  const selected = document.querySelector('input[name="q1"]:checked');
  if (!selected) {
    alert("Select an answer first");
    return;
  }

  const output = document.getElementById("output");
  output.classList.remove("hidden");

  let rationaleText = validateLLM(llmRationale)
    ? llmRationale
    : fallbackRationale;

  let html = `
  <b>üß† Auto-Detected Physiology:</b> ${ruleEngine.shockType}<br><br>

  <b>‚úÖ Correct Answer:</b> ${ruleEngine.priorityAction}<br><br>

  <b>üß¨ Pathophysiologic Rationale:</b><br>
  ${rationaleText}
  <br><br>

  <b>‚ö†Ô∏è Exam Traps Identified:</b>
  `;

  for (let key in ruleEngine.traps) {
    let t = ruleEngine.traps[key];
    html += `<div class="trap ${t.type}">
      <b>Option ${key}</b>: ${t.text}
    </div>`;
  }

  html += `
  <div class="patho">
    <b>SCFHS Logic:</b><br>
    Hypovolemia ‚Üí ‚Üì preload ‚Üí ‚Üì cardiac output ‚Üí ‚Üì MAP ‚Üí organ hypoperfusion
  </div>
  `;

  output.innerHTML = html;
}
</script>

</body>
</html>
